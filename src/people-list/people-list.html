<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/iron-flex-layout/iron-flex-layout-classes.html">
<link rel="import" href="../../bower_components/paper-input/paper-input.html">
<link rel="import" href="../../bower_components/paper-fab/paper-fab.html">
<link rel="import" href="../../bower_components/iron-icons/iron-icons.html">


<link rel="import" href="../components/people-card/people-card.html">
<link rel="import" href="../components/people-service/people-service.html">
<link rel="import" href="./people-list-add.html">


<dom-module id="people-list">
    <template>
        <style include="iron-flex iron-flex-alignment">
            :host {
                display: block;
                padding: 20px;
                width: 90%;
                color: var(--primary-color);
            }

            .search {
                margin-right: 20px;
            }

            .addfab {
                position: fixed;
                bottom: 10px;
                right: 10px;
            }
        </style>

        <!-- DATA SERVICES -->
        <people-service id="peopleService" peoples="{{peoples}}"
                        on-create-success="onCreate"></people-service>


        <section class="header layout horizontal center">
            <h2 class="flex">You have {{peoples.length}} contact(s)</h2>

        </section>


        <section name="card">
            <paper-input class="search flex" value="{{filter    }}" label="Filter by name"></paper-input>
            <div class="list layout horizontal wrap center-justified">
                <template id="peoplesRepeat" is="dom-repeat" items="{{peoples}}" filter="filterOnName">
                    <people-card people="{{item}}"></people-card>
                </template>
            </div>

            <people-list-add id="addDialog"></people-list-add>

            <paper-fab class="addfab" icon="add" on-click="openDialog"></paper-fab>

        </section>


    </template>

    <script>
        (function() {
            'use strict';
            Polymer({
                is : 'people-list',
                properties : {
                    peoples : {
                        type : Array
                    },
                    filter : {
                        type     : String,
                        observer : 'filterChanged'
                    }
                },
                listeners : {
                    'addDialog.create-people' : 'createPeople'
                },
                ready : function() {
                    this.$.peopleService.getPeoples();
                },
                filterOnName : function(item) {
                    var filter = this.filter.toLowerCase();
                    return (item.firstname.toLowerCase().indexOf(filter) != -1
                    || item.lastname.toLowerCase().indexOf(filter) != -1)
                },
                filterChanged : function() {
                    this.$.peoplesRepeat.render();
                },
                openDialog : function() {
                    this.$.addDialog.open();
                },
                createPeople : function(e) {
                    var people = e.detail;
                    this.$.peopleService.createPeople(people);
                },
                onCreate : function() {
                    this.set('route.path', '/card');
                    this.$.peopleService.getPeoples();
                }
            });
        })();
    </script>
</dom-module>